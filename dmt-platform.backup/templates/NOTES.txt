{{- $mode := .Values.global.deploymentMode | default "standalone" -}}
================================================================================
  Device Management Toolkit (DMT) Platform
  Deployment Mode: {{ $mode | upper }}
================================================================================

Thank you for installing {{ .Chart.Name }} version {{ .Chart.Version }}!

{{- if eq $mode "standalone" }}

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    STANDALONE DEPLOYMENT MODE                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Platform services (PostgreSQL, Keycloak, Vault) are BUNDLED in this deployment.

ğŸ“¦ Deployed Components:
   âœ“ PostgreSQL Database
   âœ“ Keycloak Authentication
   âœ“ HashiCorp Vault
   âœ“ MPS (Management Presence Server)
   âœ“ RPS (Remote Provisioning Server)
   âœ“ DM-Manager (Device Manager)
{{- if .Values.optional.inventory.enabled }}
   âœ“ Inventory Service
{{- end }}

ğŸ“Š Resource Footprint:
   Pods: ~8 (3 platform + 3 DMT + optional services)
   CPU: ~2.8 cores
   Memory: ~5GB
   Storage: ~30Gi

ğŸ” Verify Deployment:
   kubectl get pods -n {{ .Release.Namespace }}
   kubectl get svc -n {{ .Release.Namespace }}

â³ Wait for all pods to be ready:
   kubectl wait --for=condition=ready pod \
     -l app.kubernetes.io/part-of=dmt-platform \
     -n {{ .Release.Namespace }} \
     --timeout=10m

ğŸŒ Access Services:
{{- if .Values.dmt.mps.service }}
   MPS (CIRA): {{ .Values.dmt.mps.service.type }} on port {{ .Values.dmt.mps.service.ports.cira }}
   MPS (Web): {{ .Values.dmt.mps.service.type }} on port {{ .Values.dmt.mps.service.ports.web }}
{{- end }}
{{- if .Values.dmt.dmManager.ingress.enabled }}
   DM-Manager: https://{{ index .Values.dmt.dmManager.ingress.hosts 0 "host" }}
{{- end }}

ğŸ” Default Credentials (CHANGE IN PRODUCTION!):
   PostgreSQL:
     User: postgres
     Password: postgres123
     Connect: kubectl exec -it <postgres-pod> -n {{ .Release.Namespace }} -- psql -U postgres

   Keycloak:
     User: admin
     Password: admin123
     URL: http://keycloak:8080

   Vault:
     Token: root
     URL: http://vault:8200

âš ï¸  SECURITY WARNING:
   Default credentials are for development only!
   Change all passwords and secrets before production use.

{{- else if eq $mode "argocd" }}

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ARGOCD/EMF DEPLOYMENT MODE                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Platform services are EXTERNAL (shared from EMF infrastructure).

ğŸ“¦ Deployed Components:
   âœ“ MPS (Management Presence Server)
   âœ“ RPS (Remote Provisioning Server)
   âœ“ DM-Manager (Device Manager)

ğŸ”— External Dependencies:
   â†’ PostgreSQL: {{ .Values.platform.postgresql.external.host }}:{{ .Values.platform.postgresql.external.port }}
   â†’ Keycloak: {{ .Values.platform.keycloak.external.url }}
   â†’ Vault: {{ .Values.platform.vault.external.address }}
{{- if .Values.optional.inventory.external.enabled }}
   â†’ Inventory: {{ .Values.optional.inventory.external.url }}
{{- end }}

ğŸ“Š Resource Footprint:
   Pods: ~6 (3 DMT services x 2 replicas)
   CPU: ~1.2 cores
   Memory: ~1.5GB
   Storage: 0Gi (uses external)

ğŸ” Verify Deployment:
   kubectl get pods -n {{ .Release.Namespace }}
   kubectl get svc -n {{ .Release.Namespace }}

â³ Wait for all pods to be ready:
   kubectl wait --for=condition=ready pod \
     -l app.kubernetes.io/part-of=dmt-platform \
     -n {{ .Release.Namespace }} \
     --timeout=5m

ğŸ”Œ Verify Cross-Namespace Connectivity:
   # Test DMT â†’ Vault
   kubectl exec -it <mps-pod> -n {{ .Release.Namespace }} -- \
     curl {{ .Values.platform.vault.external.address }}/v1/sys/health

   # Test DMT â†’ PostgreSQL
   kubectl exec -it <mps-pod> -n {{ .Release.Namespace }} -- \
     pg_isready -h {{ .Values.platform.postgresql.external.host }} -p {{ .Values.platform.postgresql.external.port }}

   # Test DMT â†’ Keycloak
   kubectl exec -it <dm-manager-pod> -n {{ .Release.Namespace }} -- \
     curl {{ .Values.platform.keycloak.external.url }}/health

ğŸ“‹ Pre-Deployment Checklist:
   â˜ PostgreSQL databases created (mpsdb, rpsdb)
   â˜ Keycloak realm created (dmt-realm)
   â˜ Keycloak client created (dmt-platform)
   â˜ Vault AppRole configured (dmt-services)
   â˜ Kubernetes secrets created:
     - mps-db-secret
     - rps-db-secret
     - dmt-keycloak-client-secret
     - vault-approle-secret

{{- end }}

ğŸ“š Next Steps:
   1. Verify all pods are running
   2. Check service endpoints
   3. Test device activation
   4. Configure AMT profiles
   5. Onboard first device

ğŸ”§ Troubleshooting:
   # Check pod logs
   kubectl logs -l app.kubernetes.io/part-of=dmt-platform -n {{ .Release.Namespace }}

   # Check pod events
   kubectl get events -n {{ .Release.Namespace }} --sort-by='.lastTimestamp'

   # Check resource usage
   kubectl top pods -n {{ .Release.Namespace }}

ğŸ“– Documentation:
   - README: ./README.md
   - DMT Docs: https://github.com/device-management-toolkit/docs
   - EMF Docs: https://edge-orchestrator.intel.com/docs

ğŸ’¬ Support:
   - GitHub Issues: https://github.com/open-edge-platform/infra-charts/issues
   - Community: https://community.intel.com/

================================================================================
Release Name: {{ .Release.Name }}
Namespace: {{ .Release.Namespace }}
Chart Version: {{ .Chart.Version }}
App Version: {{ .Chart.AppVersion }}
================================================================================
